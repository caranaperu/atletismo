<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>amCharts examples</title>
        <link rel="stylesheet" href="style.css" type="text/css">
        <script src="../../graphlib/amcharts/amcharts.js" type="text/javascript"></script>
        <script src="../../graphlib/amcharts/serial.js" type="text/javascript"></script>
        <script src="../../graphlib/amcharts/themes/light.js" type="text/javascript"></script>
        <script src="../../graphlib/amcharts/amstock.js" type="text/javascript"></script>
        <style>
            body
            {
                font-size:11px;
                color:#000000;
                background-color:#ffffff;
                font-family:verdana,helvetica,arial,sans-serif;
            }
        </style>

        <script type="text/javascript">
            var chart;
            var chartDef;

            AmCharts.loadJSON = function(url) {
                // create the request
                if (window.XMLHttpRequest) {
                    // IE7+, Firefox, Chrome, Opera, Safari
                    var request = new XMLHttpRequest();
                } else {
                    // code for IE6, IE5
                    var request = new ActiveXObject('Microsoft.XMLHTTP');
                }

                // load it
                // the last "false" parameter ensures that our code will wait before the
                // data is loaded
                request.open('GET', url, false);
                request.send();

               // console.log(request.responseText + ';');
                if (request.status == 200) {
                    try {
                        var xx = eval('(' + request.responseText.trim() + ')');
                        if (xx.response.status != 0) {
                            alert(xx.response.error);
                        }
                        //alert(xx);
                       // console.log('xxxxxxxxxxxxxxxxxxx');
                       // console.log(xx);
                       /// console.log('xxxxxxxxxxxxxxxxxxxxx');

                    } catch (e) {
                        console.log(e);
                        alert(e.message);
                        alert(request.responseText);
                    }

                    // parse adn return the output
                    return xx;
                } else {
                    // alert(request.responseText);
                    return null;
                }
            };

            function showLabels(prm) {
                if (prm == 1) {
                    //     chart.hideStockEvents();
                    chartDef.panels[0].stockGraphs[0].labelText = "[[value]]";
                    //   chartDef.panels[0].stockGraphs[0].bullet= 'round';
                    chart.panels[0].stockGraphs[0].showBullets();
                    // chart.hideStockEvents();

                } else {
                    chartDef.panels[0].stockGraphs[0].labelText = "";
                    chart.showStockEvents()
                }
                chart.validateNow();
            }

            AmCharts.ready(function() {

                var chartData = AmCharts.loadJSON('/atletismo/index.php/atletasResultadosGraphDataController?op=fetch&libid=Amcharts&_operationId=fetchResultadosPorPrueba&pruebas_codigo=100MV');

                chartDef = {
                    type: "stock",
                    theme: "none",
                    pathToImages: "../../graphlib/amcharts/images/",
                    dataDateFormat: "YYYY-MM-DD",
                    dataSets: [{
                            title: chartData.response.seriesTitles[0],
                            fieldMappings: [{
                                    fromField: "nresultado",
                                    toField: "nresultado"
                                }],
                            dataProvider: chartData.response.seriesData[0],
                            categoryField: "fecha"
                        },
                        {
                            title: chartData.response.seriesTitles[1],
                            fieldMappings: [{
                                    fromField: "nresultado",
                                    toField: "nresultado"
                                }],
                            dataProvider: chartData.response.seriesData[1],
                            categoryField: "fecha"
                        }
                    ],
                    panelsSettings: {
                        creditsPosition: 'top-left',
                        autoMargins: false,
                        marginLeft: 20,
                        marginRight: 20
                    },
                    panels: [{
                            showCategoryAxis: true,
                            //   title: "Value",
                            recalculateToPercents: 'never',
                            "titles": [{text: 'Resultados ' + chartData.response.prueba, size: 20}],
                            //  valueAxesSettings: {inside: true},
                            valueAxes: [{
                                    axisColor: "#000000",
                                    axisAlpha: 0,
                                    //    minimum: 1000
                                }],
                            chartCursor: {
                                "cursorPosition": "mouse"
                            },
                            categoryAxis: {
                                "axisColor": "#000000",
                            },
                            stockGraphs: [{
                                    id: "g1",
                                    valueField: "nresultado",
                                    comparable: true,
                                    compareField: "nresultado",
                                    balloonText: "[[title]]:<b>[[value]]</b><br/>[[category]]<br/><span style='font-size:8px;'>[[comentario]]<br/>[[lugar]]</span>",
                                    compareGraphBalloonText: "[[title]]:<b>[[value]]</b><br/>[[category]]<br/>[[comentario]]<br/>[[lugar]]",
                                    bullet: "round",
                                    //   "customBullet": "../../graphlib/amcharts/images/star.png",
                                    //     "customBulletField": "customBullet",
                                    useLineColorForBulletBorder: false,
                                    bulletBorderAlpha: 1,
                                    bulletBorderColor: '#000000',
                                    compareGraphBullet: 'round',
                                    compareGraphBulletBorderAlpha: 1,
                                    compareGraphBulletBorderColor: '#000000',
                                    compareGraphLineThickness: 2,
                                    lineThickness: 2,
                                    fontSize: 10,
                                    labelText: "[[value]]",
                                    labelPosition: 'right',
                                    precision: 2,
                                    showEventsOnComparedGraphs: true,
                                    //   compareGraphLabelText: "[[value]]",
                                    // labelsEnabled: false,
                                    //creditsPosition: 'bottom-left'

                                }],
                            stockLegend: {
                                valueTextRegular: "[[value]]"
                            }
                        }
                    ],
                    balloon: {
                        textAlign: 'left',
                        fontSize: 8
                    },
                    chartScrollbarSettings: {
                        graph: "g1",
                        autoGridCount: true,
                        height: 30
                    },
                    chartCursorSettings: {
                        valueBalloonsEnabled: true,
                        categoryBalloonEnabled: false,
                        cursorAlpha: 0.1
                    },
                    dataSetSelector: {
                        position: "top",
                        compareText: ' vs '
                    },
                    periodSelector: {
                        position: "bottom",
                        hideOutOfScopePeriods: false,
                        inputFieldsEnabled: false,
                        periods: [{
                                period: "MM",
                                count: 1,
                                label: "1 month"
                            }, {
                                period: "YYYY",
                                count: 1,
                                label: "1 year"
                            }, {
                                period: "MAX",
                                label: "MAX",
                                selected: true
                            }]}
                };

                if (chartData.response.um == 'MS' || chartData.response.um == 'HMS') {
                    chartDef.panels[0].valueAxes[0].duration = "ss";
                    chartDef.panels[0].valueAxes[0].durationUnits = {
                        "hh": ":",
                        "mm": ":",
                        "ss": "s"
                    }
                } else if (chartData.response.um == 'SEG') {
                    chartDef.panels[0].valueAxes[0].unit = "s";
                } else if (chartData.response.um == 'MTSCM') {
                    chartDef.panels[0].valueAxes[0].unit = "cm";
                } else if (chartData.response.um == 'PUNT') {
                    chartDef.panels[0].valueAxes[0].unit = "ptos";
                    chartDef.panels[0].stockGraphs[0].precision = 0;
                }

                // Eventos
                // Recorro los resultados
                /*   var evt = {
                 date: '2014-03-01',
                 type: "flag",
                 backgroundColor: "#FFFFFF",
                 backgroundAlpha: 0.5,
                 graph: "g1",
                 text: "F",
                 description: "Some longerntext can alson be added"
                 };*/
                console.log(chartData.response.seriesData[1][0]);
                chartData.response.seriesData[0][0].customBullet = "http://www.amcharts.com/lib/3/images/redstar.png";
                chartData.response.seriesData[1][0].customBullet = "http://www.amcharts.com/lib/3/images/redstar.png";
                chartDef.dataSets[0].stockEvents =
                        [{
                                date: '2014-03-01',
                                type: "sign",
                                //  backgroundColor: "#FF0000",
                                backgroundAlpha: 1,
                                graph: "g1",
                                text: "o",
                                //  description: "Some longerntext can alson be added",
                                //    showOnAxis:true

                            }];
                chartDef.dataSets[1].stockEvents =
                        [{
                                date: '2014-03-01',
                                type: "sign",
                                //  backgroundColor: "#FF0000",
                                backgroundAlpha: 1,
                                graph: "g1",
                                text: "o",
                                //  description: "Some longerntext can alson be added",
                                //  showOnAxis:true

                            }, {
                                date: '2014-03-07',
                                type: "sign",
                                //      backgroundColor: "#00FF00",
                                backgroundAlpha: 0.5,
                                graph: "g1",
                                text: "o",
                                // description: "Some longerntext can alson be added",
                                // showOnAxis:true
                            }];
                chart = AmCharts.makeChart("chartdiv", chartDef);

            });


        </script>
    </head>

    <body >
        <div id="chartdiv" style="width: 100%; height: 400px;"></div>
        <div id="selector">Select a dataset:
            <label><input type="radio" value="0" name="showLabels" checked="checked" onclick="showLabels(1);"> Mostrar Valores</label>
            <label><input type="radio" value="1" name="showLabels" onclick="showLabels(0);"> Mostra Indicadores</label>
        </div>
    </body>
</html>